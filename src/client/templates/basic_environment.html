scale = 30
canvas = $('#canvas')     
code = $('#codes')
message = $('#message')

window.peanutty = new Peanutty(canvas, code, message, scale, new b2d.Common.Math.b2Vec2(0, 10))

static = false
unbindMouseEvents = (canvas) =>
    canvas.unbind 'mousedown'
    canvas.unbind 'mouseup'
    canvas.unbind 'mousemove'
    canvas.unbind 'click'

initiateFree = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) => 
        x = e.offsetX
        y = e.offsetY

        firstPoint = if peanutty.currentShape? then peanutty.currentShape.path[0] else null
        if firstPoint? && Math.abs(firstPoint.x - x) < 5 && Math.abs(firstPoint.y - y) < 5
            peanutty.endFreeformShape
                static: static
                time: getTimeDiff()
            return
            
        peanutty.addToFreeformShape(x, y)    
        return
                               
    canvas.bind 'mousemove', (e) =>
        peanutty.addTempToFreeformShape(e.offsetX, e.offsetY)
        return

initiateBox = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) =>
        peanutty.addToScript
            command:
                """
                peanutty.createBox
                    x: #{{e.offsetX - 10}}
                    y: #{{e.offsetY - 10}}
                    width: 20
                    height: 20
                    static: #{{static}}
                """
            time: getTimeDiff()

initiateBall = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) =>     
        peanutty.addToScript
            command: 
                """
                peanutty.createBall
                    x: #{{e.offsetX}}
                    y: #{{e.offsetY}}
                    radius: 20
                    static: #{{static}}
                """
            time: getTimeDiff()
    
getTimeDiff = () =>
    timeDiff = if view.time? then new Date() - view.time else 0
    view.time = new Date() 
    return timeDiff

view.$('#tools #free').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #free').addClass('selected')
    initiateFree(canvas)
view.$('#tools #box').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #box').addClass('selected')
    initiateBox(canvas)
view.$('#tools #ball').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #ball').addClass('selected')
    initiateBall(canvas)
view.$('#tools #static').bind 'click', () => 
    $('#tools .setting').removeClass('selected')
    $('#tools #static').addClass('selected')
    static = true
view.$('#tools #dynamic').bind 'click', () => 
    $('#tools .setting').removeClass('selected')
    $('#tools #dynamic').addClass('selected')
    static = false

view.$('#tools #ball').click()
view.$('#tools #dynamic').click()


# LETTERS

Peanutty::createLetter = (options={{}}) ->
    x = options.x
    y = options.y
    letter = options.letter
    
    switch letter
        when "a"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x-40, y: y}},{{x: x-12, y: y-70}},{{x: x, y: y-70}},{{x: x-27, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-14, y: y-32}},{{x: x-19, y: y-20}},{{x: x-6, y: y-20}},{{x: x-6, y: y-32}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y-70}},{{x: x-6, y: y-54}},{{x: x+16, y: y}},{{x: x+30, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-6, y: y-32}},{{x: x-6, y: y-20}},{{x: x+7, y: y-20}},{{x: x+3, y: y-32}}])
                ]
        when "A"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x-48, y: y}},{{x: x-15, y: y-90}},{{x: x, y: y-90}},{{x: x-35, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-22, y: y-32}},{{x: x-26, y: y-20}},{{x: x-6, y: y-20}},{{x: x-6, y: y-32}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y-90}},{{x: x-6, y: y-73}},{{x: x+16, y: y}},{{x: x+30, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-6, y: y-32}},{{x: x-6, y: y-20}},{{x: x+9, y: y-20}},{{x: x+6, y: y-32}}])
                ]
        when "b"
            @createBox x: x,    y: y-60, width: 25, height: 5 
            @createBox x: x-20, y: y-30, width: 5,  height: 25
            @createBox x: x+20, y: y-15, width: 5,  height: 10
            @createBox x: x+10, y: y-30, width: 10, height: 5 
            @createBox x: x+20, y: y-45, width: 5,  height: 10
            @createBox x: x, y: y,       width: 25, height: 5             
        when "B"
            @createBox x: x,    y: y-80, width: 30, height: 5
            @createBox x: x-20, y: y-40, width: 10, height: 35
            @createBox x: x+25, y: y-20, width: 5,  height: 15
            @createBox x: x+10, y: y-40, width: 15, height: 5
            @createBox x: x+25, y: y-60, width: 5,  height: 15
            @createBox x: x, y: y,       width: 30, height: 5
        when "c"
            @createBox x: x, y: y, width: 25, height: 5                   
            @createBox x: x-15, y: y-30, width: 10, height: 25            
            @createBox x: x, y: y-60, width: 25, height: 5                
            @createBox x: x-20, y: y-69, width: 6, height: 2, density: 10 
        when "C"
            @createBox x: x,    y: y,    width: 30, height: 5                   
            @createBox x: x-20, y: y-40, width: 10, height: 35            
            @createBox x: x,    y: y-80, width: 30, height: 5                
            @createBox x: x-24, y: y-87, width: 8,  height: 2, density: 10 
        when "d"                      
            @createBox x: x-15, y: y,    width: 20, height: 5
            @createBox x: x-30, y: y-30, width: 5,  height: 25
            @createBox x: x,    y: y-30, width: 5,  height: 25
            @createBox x: x-15, y: y-60, width: 20, height: 5
        when "D"                      
            @createBox x: x-25, y: y,    width: 30, height: 5
            @createBox x: x-50, y: y-40, width: 5, height: 35
            @createBox x: x,    y: y-40, width: 5, height: 35
            @createBox x: x-25, y: y-80, width: 30, height: 5
        when "e"
            @createBox x: x,    y: y,    width: 25, height: 5
            @createBox x: x-15, y: y-15, width: 10, height: 10
            @createBox x: x-5,  y: y-30, width: 20, height: 5
            @createBox x: x-15, y: y-45, width: 10, height: 10
            @createBox x: x,    y: y-60, width: 25, height: 5
            @createBox x: x-20, y: y-69, width: 6,  height: 2, density: 10
        when "E"
            @createBox x: x,    y: y,    width: 30, height: 5               
            @createBox x: x-20, y: y-20, width: 10, height: 15              
            @createBox x: x-10, y: y-40, width: 20, height: 5               
            @createBox x: x-20, y: y-60, width: 10, height: 15              
            @createBox x: x, y: y-80,    width: 30, height: 5               
            @createBox x: x-25, y: y-86, width: 6,  height: 2, density: 10  
        when "f"
            @createBox x: x-15, y: y-10, width: 10, height: 15, density: 10 
            @createBox x: x-5,  y: y-30, width: 20, height: 5                  
            @createBox x: x-15, y: y-45, width: 10, height: 10                 
            @createBox x: x,    y: y-60, width: 25, height: 5                  
            @createBox x: x-20, y: y-69, width: 6,  height: 2,  density: 10    
        when "F"
            @createBox x: x-20, y: y-15, width: 10, height: 20, density: 10              
            @createBox x: x-10, y: y-40, width: 20, height: 5                
            @createBox x: x-20, y: y-60, width: 10, height: 15               
            @createBox x: x, y: y-80,    width: 30, height: 5                
            @createBox x: x-25, y: y-86, width: 6,  height: 2,  density: 10  
        when "g"
            @createBox x: x,    y: y-60, width: 25, height: 5              
            @createBox x: x-18, y: y-30, width: 7,  height: 25             
            @createBox x: x+20, y: y-15, width: 5,  height: 10             
            @createBox x: x+10, y: y-30, width: 15, height: 5
            @createBox x: x+20, y: y-35, width: 6,  height: 2, density: 10  
            @createBox x: x, y: y,       width: 25, height: 5              
            @createBox x: x-22, y: y-69, width: 8,  height: 2, density: 10 
        when "G"
            @createBox x: x,    y: y-80, width: 30, height: 5              
            @createBox x: x-20, y: y-40, width: 10, height: 35             
            @createBox x: x+25, y: y-20, width: 5,  height: 15             
            @createBox x: x+15, y: y-40, width: 15, height: 5              
            @createBox x: x+25, y: y-47, width: 6,  height: 2, density: 10 
            @createBox x: x,    y: y,    width: 30, height: 5              
            @createBox x: x-22, y: y-87, width: 8,  height: 2, density: 10 
        when "H"
            @createBox(x: x-40, y: y, width: 10, height: 20)
            @createBox(x: x, y: y, width: 10, height: 20)
            @createBox(x: x-20, y: y-25, width: 30, height: 5)
            @createBox(x: x-40, y: y-50, width: 10, height: 20)
            @createBox(x: x, y: y-50, width: 10, height: 20)
        when "l"
            @createBox(x: x, y: y, width: 20, height: 5)
            @createBox(x: x-15, y: y-35, width: 5, height: 30)
        when "o"
            @createBox(x: x-15, y: y, width: 20, height: 5)
            @createBox(x: x-30, y: y-30, width: 5, height: 25)
            @createBox(x: x, y: y-30, width: 5, height: 25)
            @createBox(x: x-15, y: y-60, width: 20, height: 5)
        when "r"       
            @createBox(x: x-30, y: y-15, width: 5, height: 30)
            @createBox(x: x-7, y: y, width: 5, height: 15)
            @createBox(x: x-10, y: y-20, width: 15, height: 5)
            @createBox(x: x, y: y-35, width: 5, height: 10)
            @createBox(x: x-15, y: y-50, width: 20, height: 5)
        when "W"       
            @createBox(x: x-30, y: y, width: 40, height: 5)
            @createBox(x: x-60, y: y-45, width: 10, height: 40)
            @createBox(x: x, y: y-45, width: 10, height: 40)
            @createBox(x: x-30, y: y-20, width: 5, height: 15)
