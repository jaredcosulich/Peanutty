<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="favicon.png" />
    <title>Peanutty</title>
    <link rel="stylesheet" href="build/client/css/all.css" type="text/css" />
    
    
    <script type="text/javascript" src="http://github.com/jashkenas/coffee-script/raw/master/extras/coffee-script.js"> </script>
    <script src="src/client/js/lib/ender.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/views/base.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/views/home.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/views/main.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/init.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/util.js" type="text/javascript" charset="utf-8"></script>
    
    <style type="text/css">
        @font-face {
  font-family: 'Mingl Icons';
  src: url('src/client/css/fonts/icons-webfont.eot');
  src: url('src/client/css/fonts/icons-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/icons-webfont.woff') format('woff'), url('src/client/css/fonts/icons-webfont.ttf') format('truetype'), url('src/client/css/fonts/icons-webfont.svg#MinglIcons') format('svg');
  font-weight: normal;
  font-style: normal;
}
/* Museo: A font by Jos Buivenga (exljbris) -&gt; www.exljbris.com */@font-face {
  font-family: 'Museo';
  src: url('src/client/css/fonts/museo500-regular-webfont.eot');
  src: url('src/client/css/fonts/museo500-regular-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museo500-regular-webfont.woff') format('woff'), url('src/client/css/fonts/museo500-regular-webfont.ttf') format('truetype'), url('src/client/css/fonts/museo500-regular-webfont.svg#webfontnuwysBIH') format('svg');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'Museo';
  src: url('src/client/css/fonts/museo300-regular-webfont.eot');
  src: url('src/client/css/fonts/museo300-regular-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museo300-regular-webfont.woff') format('woff'), url('src/client/css/fonts/museo300-regular-webfont.ttf') format('truetype'), url('src/client/css/fonts/museo300-regular-webfont.svg#webfontMmwAEq4Z') format('svg');
  font-weight: lighter;
  font-style: normal;
}
@font-face {
  font-family: 'Museo';
  src: url('src/client/css/fonts/museo700-regular-webfont.eot');
  src: url('src/client/css/fonts/museo700-regular-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museo700-regular-webfont.woff') format('woff'), url('src/client/css/fonts/museo700-regular-webfont.ttf') format('truetype'), url('src/client/css/fonts/museo700-regular-webfont.svg#webfonthvYIakly') format('svg');
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: 'Museo Sans';
  src: url('src/client/css/fonts/museosans500-webfont.eot');
  src: url('src/client/css/fonts/museosans500-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museosans500-webfont.woff') format('woff'), url('src/client/css/fonts/museosans500-webfont.ttf') format('truetype'), url('src/client/css/fonts/museosans500-webfont.svg#webfont1H1968T3') format('svg');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'Museo Sans';
  src: url('src/client/css/fonts/museosans500_italic-webfont.eot');
  src: url('src/client/css/fonts/museosans500-italic-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museosans500_italic-webfont.woff') format('woff'), url('src/client/css/fonts/museosans500_italic-webfont.ttf') format('truetype'), url('src/client/css/fonts/museosans500_italic-webfont.svg#webfontq2OnKNVm') format('svg');
  font-weight: normal;
  font-style: italic;
}
    </style>
    <script data-src="templates/basic_environment.html" type="text/html" charset="utf-8">
        scale = 30
canvas = $('#canvas')     
code = $('#codes')
message = $('#message')

window.peanutty = new Peanutty
    canvas: canvas
    code: code
    message: message
    scale: scale
    gravity: new b2d.Common.Math.b2Vec2(0, 10)

# TOOLS

static = false
unbindMouseEvents = (canvas) =>
    canvas.unbind 'mousedown'
    canvas.unbind 'mouseup'
    canvas.unbind 'mousemove'
    canvas.unbind 'click'

initiateFree = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) => 
        x = e.offsetX * (peanutty.defaultScale/peanutty.scale)
        y = e.offsetY * (peanutty.defaultScale/peanutty.scale)
        
        firstPoint = if peanutty.currentShape? then peanutty.currentShape.path[0] else null
        if firstPoint? && Math.abs(firstPoint.x - x) < 5 && Math.abs(firstPoint.y - y) < 5
            peanutty.endFreeformShape
                static: static
                time: getTimeDiff()
            return
            
        peanutty.addToFreeformShape(x: x, y: y) 
            
        return
                               
    canvas.bind 'mousemove', (e) =>
        peanutty.addTempToFreeformShape
            x: e.offsetX * (peanutty.defaultScale/peanutty.scale)
            y: e.offsetY * (peanutty.defaultScale/peanutty.scale)
        return

initiateBox = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) =>
        peanutty.addToScript
            command:
                """
                peanutty.createBox
                    x: #{{e.offsetX * (peanutty.defaultScale/peanutty.scale)}}
                    y: #{{e.offsetY * (peanutty.defaultScale/peanutty.scale)}}
                    width: 20
                    height: 20
                    static: #{{static}}
                """
            time: getTimeDiff()

initiateBall = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) =>     
        peanutty.addToScript
            command: 
                """
                peanutty.createBall
                    x: #{{e.offsetX * (peanutty.defaultScale/peanutty.scale)}}
                    y: #{{e.offsetY * (peanutty.defaultScale/peanutty.scale)}}
                    radius: 20
                    static: #{{static}}
                """
            time: getTimeDiff()
    
getTimeDiff = () =>
    timeDiff = if view.time? then new Date() - view.time else 0
    view.time = new Date() 
    return timeDiff

view.$('#tools #free').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #free').addClass('selected')
    initiateFree(canvas)
view.$('#tools #box').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #box').addClass('selected')
    initiateBox(canvas)
view.$('#tools #ball').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #ball').addClass('selected')
    initiateBall(canvas)
view.$('#tools #static').bind 'click', () => 
    $('#tools .setting').removeClass('selected')
    $('#tools #static').addClass('selected')
    static = true
view.$('#tools #dynamic').bind 'click', () => 
    $('#tools .setting').removeClass('selected')
    $('#tools #dynamic').addClass('selected')
    static = false

view.$('#tools #ball').click()
view.$('#tools #dynamic').click()
    </script>
    <script data-src="templates/basic_script.html" type="text/html" charset="utf-8">
        Peanutty.setStage()
peanutty.wait(1000)
    </script>
    <script data-src="templates/chrome_only.html" type="text/html" charset="utf-8">
        <h2>Peanutty only works in <a href='https://www.google.com/chrome' target='_blank' style='text-decoration: underline;'>Google Chrome</a> right now.</h2>
    </script>
    <script data-src="templates/hello_world_stage.html" type="text/html" charset="utf-8">
        Peanutty.loadEnvironment()
peanutty.runSimulation()

peanutty.sendMessage
    message: 
        """
        <h4>Welcome to Peanutty!</h4>
        <p>
            To get started, type your name in and then destroy it with boxes, balls, or freeform shapes.
        </p>
        """

peanutty.createGround
    x: peanutty.canvas.width() / 2
    y: peanutty.canvas.height() - 50
    width: 600
    height: 10
    
# INPUTS

instructions = $(document.createElement("DIV"))
instructions.addClass('stage_element')
instructions.css
    height: '30px'
    width: '300px'
    textAlign: 'center'
    fontSize: '20pt'
    position: 'absolute'
    top: '20px'
    left: "#{{(peanutty.canvas.width() / 2) - 150}}px"
instructions.html("Type your name:")
view.$('#canvas_container').append(instructions)

window.nameInput = $(document.createElement('INPUT'))
nameInput.addClass('stage_element')
nameInput.css
    width: '300px'
    height: '30px'
    fontSize: '20pt'
    position: 'absolute'
    top: '50px'
    left: "#{{(peanutty.canvas.width() / 2) - 150}}px"
    
nameInput.bind 'keyup', (e) ->
    letters = $(e.currentTarget).val()
    return if letters.replace(/\s/g, '').length == 0
    view.loadScript()
    peanutty.destroyDynamicObjects()
    peanutty.addToScript
        command:
            """
            nameInput.val("#{{letters}}") if nameInput.val() != "#{{letters}}"
            peanutty.createLetters
                x: peanutty.canvas.width() / 2
                y: peanutty.canvas.height() - 55
                letters: "#{{letters}}"
            """
        time: 0
    window.lastNameInputKey = new Date()    
    $.timeout 1500, () =>
        return if new Date() - window.lastNameInputKey < 1500
        destroyInstructions = $(document.createElement("DIV"))
        destroyInstructions.addClass('stage_element')
        destroyInstructions.css
            height: '30px'
            width: '300px'
            textAlign: 'center'
            fontSize: '12pt'
            position: 'absolute'
            top: '90px'
            left: "#{{(peanutty.canvas.width() / 2) - 150}}px"
        destroyInstructions.html("Now destroy your name!<br/>(click anywhere above your name)")
        view.$('#canvas_container').append(destroyInstructions)
        peanutty.sendMessage
            message:
                """
                    <h3> 
                        Ready for the next challenge? 
                        <a id='next_challenge'>Load it up ></a>
                    </h3>
                """
        view.$('#next_challenge').bind 'click', => view.loadNewStage('stack_em')
            
view.$('#canvas_container').append(nameInput)
nameInput[0].focus()


codeChangeMessageShown = false
view.$('#codes .code').bind 'keypress', () =>
    return if codeChangeMessageShown
    codeChangeMessageShown = true
    peanutty.sendCodeMessage
        message:
            """
            You've changed your script.
            To see your changes you'll need to rerun your script by clicking "Run Script" above.
            (<a id='close_code_message'>close this</a>)       
            """
    view.$('#close_code_message').bind 'click', () => view.$('#codes .message').removeClass('displayed')


# LETTERS

Peanutty::createLetters = ({{x, y, letters}}) ->
    width = @getLettersWidth letters: letters
    start = x - (width / 2) - (4 * ((letters.length - 1) / 2))
    for letter in letters
        letterWidth = @getLettersWidth(letters: letter)
        @createLetter(x: start, y: y, letter: letter)
        start += letterWidth + 4
        
Peanutty::getLettersWidth = ({{letters}}) ->
    totalWidth = 0 
    for letter in letters
        if letter == ' '
            totalWidth += 25
        else
            baseWidth = if letter.toLowerCase() == letter then 50 else 60
            totalWidth += switch letter
                when 'a' then 70
                when 'A' then 78
                when 'd', 'h', 'l', 'o', 'r' then 40
                when 'W' then 80
                else baseWidth
                
    return totalWidth
    
Peanutty::createLetter = ({{x, y, letter}}) ->
    switch letter
        when "a"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x+28, y: y-70}},{{x: x+40, y: y-70}},{{x: x+13, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+26, y: y-32}},{{x: x+21, y: y-20}},{{x: x+34, y: y-20}},{{x: x+34, y: y-32}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x+40, y: y-70}},{{x: x+34, y: y-54}},{{x: x+56, y: y}},{{x: x+70, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+34, y: y-32}},{{x: x+34, y: y-20}},{{x: x+47, y: y-20}},{{x: x+43, y: y-32}}])
                ]
        when "A"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x+33, y: y-90}},{{x: x+48, y: y-90}},{{x: x+13, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+26, y: y-32}},{{x: x+22, y: y-20}},{{x: x+42, y: y-20}},{{x: x+42, y: y-32}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x+48, y: y-90}},{{x: x+42, y: y-73}},{{x: x+64, y: y}},{{x: x+78, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+42, y: y-32}},{{x: x+42, y: y-20}},{{x: x+57, y: y-20}},{{x: x+54, y: y-32}}])
                ]
        when "b"
            @createBox x: x+25, y: y-65, width: 25, height: 5    
            @createBox x: x+5,  y: y-35, width: 5,  height: 25   
            @createBox x: x+45, y: y-20, width: 5,  height: 10   
            @createBox x: x+35, y: y-35, width: 10, height: 5    
            @createBox x: x+45, y: y-50, width: 5,  height: 10   
            @createBox x: x+25, y: y-5,  width: 25, height: 5             
        when "B"
            @createBox x: x+30, y: y-85, width: 30, height: 5
            @createBox x: x+10, y: y-45, width: 10, height: 35
            @createBox x: x+55, y: y-25, width: 5,  height: 15
            @createBox x: x+40, y: y-45, width: 15, height: 5
            @createBox x: x+55, y: y-65, width: 5,  height: 15
            @createBox x: x+30, y: y-5,  width: 30, height: 5
        when "c"
            @createBox x: x+25, y: y-5,  width: 25, height: 5              
            @createBox x: x+10, y: y-35, width: 10, height: 25             
            @createBox x: x+25, y: y-65, width: 25, height: 5              
            @createBox x: x+4,  y: y-74, width: 6,  height: 2, density: 10 
        when "C"
            @createBox x: x+30, y: y-5,  width: 30, height: 5                  
            @createBox x: x+10, y: y-45, width: 10, height: 35               
            @createBox x: x+30, y: y-85, width: 30, height: 5                
            @createBox x: x+6,  y: y-92, width: 8,  height: 2, density: 10   
        when "d"                      
            @createBox x: x+20, y: y-5,  width: 20, height: 5
            @createBox x: x+5,  y: y-35, width: 5,  height: 25
            @createBox x: x+35, y: y-35, width: 5,  height: 25
            @createBox x: x+20, y: y-65, width: 20, height: 5
        when "D"                      
            @createBox x: x+30, y: y-5,  width: 30, height: 5
            @createBox x: x+5,  y: y-45, width: 5, height: 35
            @createBox x: x+55, y: y-45, width: 5, height: 35
            @createBox x: x+30, y: y-85, width: 30, height: 5
        when "e"
            @createBox x: x+25, y: y-5,  width: 25, height: 5              
            @createBox x: x+10, y: y-20, width: 10, height: 10             
            @createBox x: x+20, y: y-35, width: 20, height: 5              
            @createBox x: x+10, y: y-50, width: 10, height: 10             
            @createBox x: x+25, y: y-65, width: 25, height: 5              
            @createBox x: x+4,  y: y-74, width: 6,  height: 2, density: 10 
        when "E"
            @createBox x: x+30, y: y-5,  width: 30, height: 5               
            @createBox x: x+10, y: y-25, width: 10, height: 15              
            @createBox x: x+20, y: y-45, width: 20, height: 5               
            @createBox x: x+10, y: y-65, width: 10, height: 15              
            @createBox x: x+30, y: y-85, width: 30, height: 5               
            @createBox x: x+4,  y: y-91, width: 6,  height: 2, density: 10  
        when "f"
            @createBox x: x+10, y: y-15, width: 10, height: 15, density: 10 
            @createBox x: x+20, y: y-35, width: 20, height: 5                  
            @createBox x: x+10, y: y-50, width: 10, height: 10                 
            @createBox x: x+25, y: y-65, width: 25, height: 5                  
            @createBox x: x+4,  y: y-74, width: 6,  height: 2,  density: 10    
        when "F"
            @createBox x: x+10, y: y-20, width: 10, height: 20, density: 10              
            @createBox x: x+20, y: y-45, width: 20, height: 5                
            @createBox x: x+10, y: y-65, width: 10, height: 15               
            @createBox x: x+30, y: y-85, width: 30, height: 5                
            @createBox x: x+4,  y: y-91, width: 6,  height: 2,  density: 10  
        when "g"
            @createBox x: x+25, y: y-65, width: 25, height: 5              
            @createBox x: x+7,  y: y-35, width: 7,  height: 25             
            @createBox x: x+45, y: y-20, width: 5,  height: 10             
            @createBox x: x+35, y: y-35, width: 15, height: 5              
            @createBox x: x+45, y: y-40, width: 6,  height: 2, density: 10 
            @createBox x: x+25, y: y-5,  width: 25, height: 5              
            @createBox x: x+5,  y: y-74, width: 8,  height: 2, density: 10 
        when "G"
            @createBox x: x+30, y: y-85, width: 30, height: 5              
            @createBox x: x+10, y: y-45, width: 10, height: 35             
            @createBox x: x+55, y: y-25, width: 5,  height: 15             
            @createBox x: x+45, y: y-45, width: 15, height: 5              
            @createBox x: x+55, y: y-52, width: 6,  height: 2, density: 10 
            @createBox x: x+30, y: y-5,  width: 30, height: 5              
            @createBox x: x+5,  y: y-92, width: 8,  height: 2, density: 10 
        when "h"
            @createBox x: x+5,  y: y-15, width: 5,  height: 15 
            @createBox x: x+35, y: y-15, width: 5,  height: 15 
            @createBox x: x+20, y: y-35, width: 20, height: 5  
            @createBox x: x+5,  y: y-55, width: 5,  height: 15 
            @createBox x: x+35, y: y-55, width: 5,  height: 15 
        when "H"
            @createBox x: x+10, y: y-20, width: 10, height: 20 
            @createBox x: x+50, y: y-20, width: 10, height: 20 
            @createBox x: x+30, y: y-45, width: 30, height: 5  
            @createBox x: x+10, y: y-70, width: 10, height: 20 
            @createBox x: x+50, y: y-70, width: 10, height: 20
        when "i"
            @createBox x: x+25, y: y-5,  width: 25, height: 5  
            @createBox x: x+25, y: y-35, width: 5,  height: 25 
            @createBox x: x+25, y: y-65, width: 25, height: 5  
        when "I"
            @createBox x: x+30, y: y-5,  width: 30, height: 5  
            @createBox x: x+30, y: y-45, width: 5,  height: 35 
            @createBox x: x+30, y: y-85, width: 30, height: 5  
        when "j"
            @createBox x: x+15, y: y-5,  width: 15, height: 5  
            @createBox x: x+4,  y: y-18, width: 5,  height: 8  
            @createBox x: x+25, y: y-35, width: 5,  height: 25 
            @createBox x: x+25, y: y-65, width: 25, height: 5  
        when "J"
            @createBox x: x+17, y: y-5,  width: 18, height: 5  
            @createBox x: x+4,  y: y-18, width: 5,  height: 8  
            @createBox x: x+30, y: y-40, width: 5,  height: 35 
            @createBox x: x+30, y: y-85, width: 30, height: 5  
        when "k"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x, y: y-70}},{{x: x+10, y: y-70}},{{x: x+10, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+10, y: y-30}},{{x: x+10, y: y-40}},{{x: x+40, y: y-70}},{{x: x+50, y: y-70}}])
                ]
            @createPoly
                path: [{{x: x+10, y: y-30}},{{x: x+15, y: y-35}},{{x: x+50, y: y}},{{x: x+40, y: y}}]
        when "K"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x, y: y-90}},{{x: x+10, y: y-90}},{{x: x+10, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+10, y: y-40}},{{x: x+10, y: y-50}},{{x: x+50, y: y-90}},{{x: x+60, y: y-90}}])
                ]
            @createPoly
                path: [{{x: x+10, y: y-40}},{{x: x+15, y: y-45}},{{x: x+60, y: y}},{{x: x+50, y: y}}]
        when "l"
            @createBox x: x+20, y: y-5,  width: 20, height: 5
            @createBox x: x+5,  y: y-40, width: 5,  height: 30
        when "L"
            @createBox x: x+30, y: y-5,  width: 30, height: 5
            @createBox x: x+5,  y: y-50, width: 5,  height: 40
        when "m"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x, y: y-70}},{{x: x+10, y: y-70}},{{x: x+10, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+10, y: y-55}},{{x: x+10, y: y-70}},{{x: x+25, y: y-40}},{{x: x+25, y: y-25}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x+40, y: y}},{{x: x+40, y: y-70}},{{x: x+50, y: y-70}},{{x: x+50, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+25, y: y-25}},{{x: x+25, y: y-40}},{{x: x+40, y: y-70}},{{x: x+40, y: y-55}}])
                ]
        when "M"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x, y: y-90}},{{x: x+10, y: y-90}},{{x: x+10, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+10, y: y-75}},{{x: x+10, y: y-90}},{{x: x+30, y: y-60}},{{x: x+30, y: y-45}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x+50, y: y}},{{x: x+50, y: y-90}},{{x: x+60, y: y-90}},{{x: x+60, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+30, y: y-45}},{{x: x+30, y: y-60}},{{x: x+50, y: y-90}},{{x: x+50, y: y-75}}])
                ]
        when "n"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x, y: y-70}},{{x: x+10, y: y-70}},{{x: x+10, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+10, y: y-70}},{{x: x+10, y: y-55}},{{x: x+40, y: y}},{{x: x+40, y: y-15}}])
                ]
            @createPoly
                path: [{{x: x+40, y: y}},{{x: x+40, y: y-70}},{{x: x+50, y: y-70}},{{x: x+50, y: y}}]
        when "N"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y}},{{x: x, y: y-90}},{{x: x+10, y: y-90}},{{x: x+10, y: y}}]),
                    @polyFixtureDef(path: [{{x: x+10, y: y-90}},{{x: x+10, y: y-75}},{{x: x+50, y: y}},{{x: x+50, y: y-15}}])
                ]
            @createPoly
                path: [{{x: x+50, y: y}},{{x: x+50, y: y-90}},{{x: x+60, y: y-90}},{{x: x+60, y: y}}]
        when "o"
            @createBox x: x+20, y: y-5,  width: 20, height: 5
            @createBox x: x+5,  y: y-35, width: 5, height: 25
            @createBox x: x+35, y: y-35, width: 5, height: 25
            @createBox x: x+20, y: y-65, width: 20, height: 5
        when "p"
            return
        when "P"
            return
        when "q"
            return
        when "Q"
            return
        when "r"       
            @createBox x: x+5,  y: y-20, width: 5, height: 30 
            @createBox x: x+28, y: y-5,  width: 5, height: 15 
            @createBox x: x+25, y: y-25, width: 15, height: 5 
            @createBox x: x+35, y: y-40, width: 5, height: 10 
            @createBox x: x+20, y: y-55, width: 20, height: 5 
        when "R"
            return
        when "s"
            return
        when "S"
            return
        when "t"
            @createBox x: x+25, y: y-30, width: 5,  height: 30 
            @createBox x: x+25, y: y-60, width: 25, height: 5  
        when "T"
            @createBox x: x+30, y: y-40, width: 5,  height: 40 
            @createBox x: x+30, y: y-80, width: 30, height: 5  
        when "u"
            @createBox x: x+20, y: y-5,  width: 20, height: 5
            @createBox x: x+5,  y: y-40, width: 5,  height: 30
            @createBox x: x+35,  y: y-40, width: 5,  height: 30
        when "U"
            @createBox x: x+30, y: y-5,  width: 30, height: 5
            @createBox x: x+5,  y: y-50, width: 5,  height: 40
            @createBox x: x+55,  y: y-50, width: 5,  height: 40
        when "v"
            return
        when "V"
            return
        when "w"
            @createBox x: x+40, y: y-5,  width: 40, height: 5
            @createBox x: x+10, y: y-45, width: 10, height: 40
            @createBox x: x+70, y: y-45, width: 10, height: 40
            @createBox x: x+40, y: y-20, width: 5,  height: 15
        when "W"       
            @createBox x: x+40, y: y-5,  width: 40, height: 5
            @createBox x: x+10, y: y-45, width: 10, height: 40
            @createBox x: x+70, y: y-45, width: 10, height: 40
            @createBox x: x+40, y: y-20, width: 5,  height: 15
        when "x"
            return
        when "X"
            return
        when "y"
            return
        when "Y"
            return
        when "z"
            return
        when "Z"
            return
        else 
            return



    </script>
    <script data-src="templates/home.html" type="text/html" charset="utf-8">
        <div id='top_area'>
    <div id='message'></div>
    <div id='execute'>
        <a class="reset_script submit button bg-green">
            <label>Reset&nbsp;Script</label>
        </a>
        <a class="load_script submit button bg-green">
            <label>Load&nbsp;Script</label>
        </a>
        <a class="run_script submit button bg-green">
            <label>Run&nbsp;Script</label>
        </a>
    </div>
</div>

<div id='tools'>
    <div id='free' class='tool'>
        Free
    </div>
    <div id='box' class='tool'>
        Box
    </div>
    <div id='ball' class='tool selected'>
        Ball
    </div>
    <div class='tool_spacer'></div>
    <div id='static' class='setting'>
        Static
    </div>
    <div id='dynamic' class='setting selected'>
        Falling
    </div>
</div>
<div id='canvas_container'>
    <canvas id='canvas' width="800" height="500"></canvas>
</div>
<div id='console'>
    <div id='tabs'>
        <a class='tab script selected'>Script</a>
        <a class='tab stage'>Stage</a>
        <a class='tab environment'>Environment</a>
    </div>
    <div id='codes'>
        <div class='message'></div>
        <div class='code script selected' contenteditable=true></div>
        <div class='code stage' contenteditable=true></div>
        <div class='code environment' contenteditable=true></div>        
    </div>
</div>

    </script>
    <script data-src="templates/main.html" type="text/html" charset="utf-8">
            <div id='header'>
        <h1>Peanutty! (0.0.1)</h1>
    </div>
    <div id='content'></div>

    </script>
    <script data-src="templates/stack_em_stage.html" type="text/html" charset="utf-8">
        Peanutty.loadEnvironment()
peanutty.runSimulation()

peanutty.sendMessage
    message: 
        """
        <h4>Stack 'Em Up!</h4>
        <p>
            Can you build a tower to reach the star?
            <a href='javascript:void(0)' onclick="view.$('#execute .reset_script').click()">Reset and try again.</a>
        </p>
        """

window.setUpChallenge = (scale=30) =>
    peanutty.destroyWorld()
    peanutty.setScale(scale)
    
    peanutty.createAchievementStar
        x: peanutty.canvas.width() / 2
        y: 100
        totalPoints: if (12 * scale / 30) > 8 then (12 * scale / 30) else 8 
        radius: 16 * scale / 30

    peanutty.createGround
        x: (peanutty.canvas.width() * (30/scale)) / 2
        y: (peanutty.canvas.height() * (30/scale)) - 50
        width: 600
        height: 10
    
    peanutty.createBall
        x: (peanutty.canvas.width() * (30/scale)) / 2
        y: (peanutty.canvas.height() * (30/scale)) - 75
        radius: 20   
    
    peanutty.createBox
        x: (peanutty.canvas.width() * (30/scale)) / 2
        y: (peanutty.canvas.height() * (30/scale)) - 100
        width: 150
        height: 5
    
    peanutty.createBox
        x: (peanutty.canvas.width() * (30/scale)) / 2
        y: (peanutty.canvas.height() * (30/scale)) - 140
        width: 20
        height: 20

    peanutty.createBox
        x: (peanutty.canvas.width() * (30/scale)) / 2
        y: (peanutty.canvas.height() * (30/scale)) - 200
        width: 20
        height: 20


setUpChallenge()
    
instructions = $(document.createElement("DIV"))
instructions.css
    width: "#{{peanutty.canvas.width()}}px"
    textAlign: 'center'
    position: 'absolute'
    top: '20px'
    left: 0

header = $(document.createElement("DIV"))
header.addClass('stage_element')
header.css
    height: '30px'
    fontSize: '20pt'
header.html("Build a tower to reach the star.")
instructions.append(header)

level = $(document.createElement("DIV"))
level.addClass('stage_element')
level.css
    height: '20px'
    fontSize: '12pt'
level.html("(<a id='level_30'>easy</a> | <a id='level_20'>medium</a> | <a id='level_10'>hard</a>)")
instructions.append(level)

view.$('#canvas_container').append(instructions)

for level in [10,20,30]
    do (level) ->
        view.$("#level_#{{level}}").bind 'click', () -> 
            peanutty.addToScript
                command: "setUpChallenge(#{{level}})"
                time: 0

view.$('#tools #box').click()
    </script>    
</head>
<body>
</body>
</html>