<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="favicon.png" />
    <title>Peanutty</title>
    <link rel="stylesheet" href="build/client/css/all.css" type="text/css" />
    
    
    <script type="text/javascript" src="http://github.com/jashkenas/coffee-script/raw/master/extras/coffee-script.js"> </script>
    <script src="src/client/js/lib/ender.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/views/base.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/views/home.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/views/main.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/init.js" type="text/javascript" charset="utf-8"></script>
    <script src="build/client/js/util.js" type="text/javascript" charset="utf-8"></script>
    
    <style type="text/css">
        @font-face {
  font-family: 'Mingl Icons';
  src: url('src/client/css/fonts/icons-webfont.eot');
  src: url('src/client/css/fonts/icons-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/icons-webfont.woff') format('woff'), url('src/client/css/fonts/icons-webfont.ttf') format('truetype'), url('src/client/css/fonts/icons-webfont.svg#MinglIcons') format('svg');
  font-weight: normal;
  font-style: normal;
}
/* Museo: A font by Jos Buivenga (exljbris) -&gt; www.exljbris.com */@font-face {
  font-family: 'Museo';
  src: url('src/client/css/fonts/museo500-regular-webfont.eot');
  src: url('src/client/css/fonts/museo500-regular-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museo500-regular-webfont.woff') format('woff'), url('src/client/css/fonts/museo500-regular-webfont.ttf') format('truetype'), url('src/client/css/fonts/museo500-regular-webfont.svg#webfontnuwysBIH') format('svg');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'Museo';
  src: url('src/client/css/fonts/museo300-regular-webfont.eot');
  src: url('src/client/css/fonts/museo300-regular-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museo300-regular-webfont.woff') format('woff'), url('src/client/css/fonts/museo300-regular-webfont.ttf') format('truetype'), url('src/client/css/fonts/museo300-regular-webfont.svg#webfontMmwAEq4Z') format('svg');
  font-weight: lighter;
  font-style: normal;
}
@font-face {
  font-family: 'Museo';
  src: url('src/client/css/fonts/museo700-regular-webfont.eot');
  src: url('src/client/css/fonts/museo700-regular-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museo700-regular-webfont.woff') format('woff'), url('src/client/css/fonts/museo700-regular-webfont.ttf') format('truetype'), url('src/client/css/fonts/museo700-regular-webfont.svg#webfonthvYIakly') format('svg');
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: 'Museo Sans';
  src: url('src/client/css/fonts/museosans500-webfont.eot');
  src: url('src/client/css/fonts/museosans500-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museosans500-webfont.woff') format('woff'), url('src/client/css/fonts/museosans500-webfont.ttf') format('truetype'), url('src/client/css/fonts/museosans500-webfont.svg#webfont1H1968T3') format('svg');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'Museo Sans';
  src: url('src/client/css/fonts/museosans500_italic-webfont.eot');
  src: url('src/client/css/fonts/museosans500-italic-webfont.eot?#iefix') format('embedded-opentype'), url('src/client/css/fonts/museosans500_italic-webfont.woff') format('woff'), url('src/client/css/fonts/museosans500_italic-webfont.ttf') format('truetype'), url('src/client/css/fonts/museosans500_italic-webfont.svg#webfontq2OnKNVm') format('svg');
  font-weight: normal;
  font-style: italic;
}
    </style>
    <script data-src="templates/basic_environment.html" type="text/html" charset="utf-8">
        scale = 30
canvas = $('#canvas')     
code = $('#codes')
message = $('#message')

window.peanutty = new Peanutty(canvas, code, message, scale, new b2d.Common.Math.b2Vec2(0, 10))

static = false
unbindMouseEvents = (canvas) =>
    canvas.unbind 'mousedown'
    canvas.unbind 'mouseup'
    canvas.unbind 'mousemove'
    canvas.unbind 'click'

initiateFree = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) => 
        x = e.offsetX
        y = e.offsetY

        firstPoint = if peanutty.currentShape? then peanutty.currentShape.path[0] else null
        if firstPoint? && Math.abs(firstPoint.x - x) < 5 && Math.abs(firstPoint.y - y) < 5
            peanutty.endFreeformShape
                static: static
                time: getTimeDiff()
            return
            
        peanutty.addToFreeformShape(x, y)    
        return
                               
    canvas.bind 'mousemove', (e) =>
        peanutty.addTempToFreeformShape(e.offsetX, e.offsetY)
        return

initiateBox = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) =>
        peanutty.addToScript
            command:
                """
                peanutty.createBox
                    x: #{{e.offsetX - 10}}
                    y: #{{e.offsetY - 10}}
                    width: 20
                    height: 20
                    static: #{{static}}
                """
            time: getTimeDiff()

initiateBall = (canvas) =>
    unbindMouseEvents(canvas)
    canvas.bind 'click', (e) =>     
        peanutty.addToScript
            command: 
                """
                peanutty.createBall
                    x: #{{e.offsetX}}
                    y: #{{e.offsetY}}
                    radius: 20
                    static: #{{static}}
                """
            time: getTimeDiff()
    
getTimeDiff = () =>
    timeDiff = if view.time? then new Date() - view.time else 0
    view.time = new Date() 
    return timeDiff

view.$('#tools #free').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #free').addClass('selected')
    initiateFree(canvas)
view.$('#tools #box').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #box').addClass('selected')
    initiateBox(canvas)
view.$('#tools #ball').bind 'click', () => 
    $('#tools .tool').removeClass('selected')
    $('#tools #ball').addClass('selected')
    initiateBall(canvas)
view.$('#tools #static').bind 'click', () => 
    $('#tools .setting').removeClass('selected')
    $('#tools #static').addClass('selected')
    static = true
view.$('#tools #dynamic').bind 'click', () => 
    $('#tools .setting').removeClass('selected')
    $('#tools #dynamic').addClass('selected')
    static = false

view.$('#tools #ball').click()
view.$('#tools #dynamic').click()


# LETTERS

Peanutty::createLetter = (options={{}}) ->
    x = options.x
    y = options.y
    letter = options.letter
    
    switch letter
        when "a"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x-40, y: y}},{{x: x-12, y: y-70}},{{x: x, y: y-70}},{{x: x-27, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-14, y: y-32}},{{x: x-19, y: y-20}},{{x: x-6, y: y-20}},{{x: x-6, y: y-32}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y-70}},{{x: x-6, y: y-54}},{{x: x+16, y: y}},{{x: x+30, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-6, y: y-32}},{{x: x-6, y: y-20}},{{x: x+7, y: y-20}},{{x: x+3, y: y-32}}])
                ]
        when "A"
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x-48, y: y}},{{x: x-15, y: y-90}},{{x: x, y: y-90}},{{x: x-35, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-22, y: y-32}},{{x: x-26, y: y-20}},{{x: x-6, y: y-20}},{{x: x-6, y: y-32}}])
                ]
            @createPoly
                fixtureDefs: [
                    @polyFixtureDef(path: [{{x: x, y: y-90}},{{x: x-6, y: y-73}},{{x: x+16, y: y}},{{x: x+30, y: y}}]),
                    @polyFixtureDef(path: [{{x: x-6, y: y-32}},{{x: x-6, y: y-20}},{{x: x+9, y: y-20}},{{x: x+6, y: y-32}}])
                ]
        when "b"
            @createBox x: x,    y: y-60, width: 25, height: 5 
            @createBox x: x-20, y: y-30, width: 5,  height: 25
            @createBox x: x+20, y: y-15, width: 5,  height: 10
            @createBox x: x+10, y: y-30, width: 10, height: 5 
            @createBox x: x+20, y: y-45, width: 5,  height: 10
            @createBox x: x, y: y,       width: 25, height: 5             
        when "B"
            @createBox x: x,    y: y-80, width: 30, height: 5
            @createBox x: x-20, y: y-40, width: 10, height: 35
            @createBox x: x+25, y: y-20, width: 5,  height: 15
            @createBox x: x+10, y: y-40, width: 15, height: 5
            @createBox x: x+25, y: y-60, width: 5,  height: 15
            @createBox x: x, y: y,       width: 30, height: 5
        when "c"
            @createBox x: x, y: y, width: 25, height: 5                   
            @createBox x: x-15, y: y-30, width: 10, height: 25            
            @createBox x: x, y: y-60, width: 25, height: 5                
            @createBox x: x-20, y: y-69, width: 6, height: 2, density: 10 
        when "C"
            @createBox x: x,    y: y,    width: 30, height: 5                   
            @createBox x: x-20, y: y-40, width: 10, height: 35            
            @createBox x: x,    y: y-80, width: 30, height: 5                
            @createBox x: x-24, y: y-87, width: 8,  height: 2, density: 10 
        when "d"                      
            @createBox x: x-15, y: y,    width: 20, height: 5
            @createBox x: x-30, y: y-30, width: 5,  height: 25
            @createBox x: x,    y: y-30, width: 5,  height: 25
            @createBox x: x-15, y: y-60, width: 20, height: 5
        when "D"                      
            @createBox x: x-25, y: y,    width: 30, height: 5
            @createBox x: x-50, y: y-40, width: 5, height: 35
            @createBox x: x,    y: y-40, width: 5, height: 35
            @createBox x: x-25, y: y-80, width: 30, height: 5
        when "e"
            @createBox x: x,    y: y,    width: 25, height: 5
            @createBox x: x-15, y: y-15, width: 10, height: 10
            @createBox x: x-5,  y: y-30, width: 20, height: 5
            @createBox x: x-15, y: y-45, width: 10, height: 10
            @createBox x: x,    y: y-60, width: 25, height: 5
            @createBox x: x-20, y: y-69, width: 6,  height: 2, density: 10
        when "E"
            @createBox x: x,    y: y,    width: 30, height: 5               
            @createBox x: x-20, y: y-20, width: 10, height: 15              
            @createBox x: x-10, y: y-40, width: 20, height: 5               
            @createBox x: x-20, y: y-60, width: 10, height: 15              
            @createBox x: x, y: y-80,    width: 30, height: 5               
            @createBox x: x-25, y: y-86, width: 6,  height: 2, density: 10  
        when "f"
            @createBox x: x-15, y: y-10, width: 10, height: 15, density: 10 
            @createBox x: x-5,  y: y-30, width: 20, height: 5                  
            @createBox x: x-15, y: y-45, width: 10, height: 10                 
            @createBox x: x,    y: y-60, width: 25, height: 5                  
            @createBox x: x-20, y: y-69, width: 6,  height: 2,  density: 10    
        when "F"
            @createBox x: x-20, y: y-15, width: 10, height: 20, density: 10              
            @createBox x: x-10, y: y-40, width: 20, height: 5                
            @createBox x: x-20, y: y-60, width: 10, height: 15               
            @createBox x: x, y: y-80,    width: 30, height: 5                
            @createBox x: x-25, y: y-86, width: 6,  height: 2,  density: 10  
        when "g"
            @createBox x: x,    y: y-60, width: 25, height: 5              
            @createBox x: x-18, y: y-30, width: 7,  height: 25             
            @createBox x: x+20, y: y-15, width: 5,  height: 10             
            @createBox x: x+10, y: y-30, width: 15, height: 5
            @createBox x: x+20, y: y-35, width: 6,  height: 2, density: 10  
            @createBox x: x, y: y,       width: 25, height: 5              
            @createBox x: x-22, y: y-69, width: 8,  height: 2, density: 10 
        when "G"
            @createBox x: x,    y: y-80, width: 30, height: 5              
            @createBox x: x-20, y: y-40, width: 10, height: 35             
            @createBox x: x+25, y: y-20, width: 5,  height: 15             
            @createBox x: x+15, y: y-40, width: 15, height: 5              
            @createBox x: x+25, y: y-47, width: 6,  height: 2, density: 10 
            @createBox x: x,    y: y,    width: 30, height: 5              
            @createBox x: x-22, y: y-87, width: 8,  height: 2, density: 10 
        when "H"
            @createBox(x: x-40, y: y, width: 10, height: 20)
            @createBox(x: x, y: y, width: 10, height: 20)
            @createBox(x: x-20, y: y-25, width: 30, height: 5)
            @createBox(x: x-40, y: y-50, width: 10, height: 20)
            @createBox(x: x, y: y-50, width: 10, height: 20)
        when "l"
            @createBox(x: x, y: y, width: 20, height: 5)
            @createBox(x: x-15, y: y-35, width: 5, height: 30)
        when "o"
            @createBox(x: x-15, y: y, width: 20, height: 5)
            @createBox(x: x-30, y: y-30, width: 5, height: 25)
            @createBox(x: x, y: y-30, width: 5, height: 25)
            @createBox(x: x-15, y: y-60, width: 20, height: 5)
        when "r"       
            @createBox(x: x-30, y: y-15, width: 5, height: 30)
            @createBox(x: x-7, y: y, width: 5, height: 15)
            @createBox(x: x-10, y: y-20, width: 15, height: 5)
            @createBox(x: x, y: y-35, width: 5, height: 10)
            @createBox(x: x-15, y: y-50, width: 20, height: 5)
        when "W"       
            @createBox(x: x-30, y: y, width: 40, height: 5)
            @createBox(x: x-60, y: y-45, width: 10, height: 40)
            @createBox(x: x, y: y-45, width: 10, height: 40)
            @createBox(x: x-30, y: y-20, width: 5, height: 15)

    </script>
    <script data-src="templates/basic_script.html" type="text/html" charset="utf-8">
        Peanutty.setStage()
peanutty.wait(1000)
    </script>
    <script data-src="templates/chrome_only.html" type="text/html" charset="utf-8">
        <h2>Peanutty only works in <a href='https://www.google.com/chrome' target='_blank' style='text-decoration: underline;'>Google Chrome</a> right now.</h2>
    </script>
    <script data-src="templates/hello_world_stage.html" type="text/html" charset="utf-8">
        Peanutty.loadEnvironment()

peanutty.sendMessage
    message: 
        """
        <h4>Welcome to Peanutty!</h4>
        <p>
            To get started, try to knock over all the letters with one object. Use a box, a ball, or a freeform shape.
            <a href='javascript:void(0)' onclick='peanutty.resetWorld(); view.loadCode(); peanutty.runScript()'>Reset and try again</a>
        </p>
        """

peanutty.createGround
    x: peanutty.canvas.width() / 2
    y: peanutty.canvas.height() - 50
    width: 600
    height: 10

x = 170
y = 490 - 50

peanutty.createLetter
    letter: "H"
    x: x
    y: y - 15

peanutty.createLetter
    letter: "e"
    x: x + 45
    y: y

peanutty.createLetter
    letter: "l"
    x: x + 100
    y: y

peanutty.createLetter
    letter: "l"
    x: x + 145
    y: y

peanutty.createLetter
    letter: "o"
    x: x + 205
    y: y

peanutty.createLetter
    letter: "W"
    x: x + 320
    y: y

peanutty.createLetter
    letter: "o"
    x: x + 370
    y: y

peanutty.createLetter
    letter: "r"
    x: x + 415
    y: y

peanutty.createLetter
    letter: "l"
    x: x + 445
    y: y

peanutty.createLetter
    letter: "d"
    x: x + 505
    y: y

peanutty.runSimulation()

    </script>
    <script data-src="templates/home.html" type="text/html" charset="utf-8">
        <div id='top_area'>
    <div id='message'></div>
    <div id='execute'>
        <a class='run_script'>Rerun Script</a>
        &nbsp;
        <a class='reset_script'>Reset Script</a>
    </div>
</div>

<div id='tools'>
    <div id='free' class='tool'>
        Free
    </div>
    <div id='box' class='tool'>
        Box
    </div>
    <div id='ball' class='tool selected'>
        Ball
    </div>
    <div class='tool_spacer'></div>
    <div id='static' class='setting'>
        Static
    </div>
    <div id='dynamic' class='setting selected'>
        Falling
    </div>
</div>
<canvas id="canvas" width="800" height="500"></canvas>
<div id='console'>
    <div id='tabs'>
        <a class='tab script selected'>Script</a>
        <a class='tab stage'>Stage</a>
        <a class='tab environment'>Environment</a>
    </div>
    <div id='codes'>
        <div class='code script selected' contenteditable=true></div>
        <div class='code stage' contenteditable=true></div>
        <div class='code environment' contenteditable=true></div>        
    </div>
</div>

    </script>
    <script data-src="templates/main.html" type="text/html" charset="utf-8">
            <div id='header'>
        <h1>Peanutty! (0.0.1)</h1>
    </div>
    <div id='content'></div>

    </script>    
</head>
<body>
</body>
</html>